# ---------------------------------------------
# ZSH CONFIG
# ---------------------------------------------
# Set leader key early
export ZSH="$HOME/.oh-my-zsh"
# Theme - commented out for Starship
# ZSH_THEME="robbyrussell"
# Plugins (keep it minimal for performance)
plugins=(
  git
  zsh-autosuggestions
  zsh-syntax-highlighting
  z
  fzf
  sudo
  command-not-found
  colored-man-pages
  colorize
)
source $ZSH/oh-my-zsh.sh

# ---------------------------------------------
# STARSHIP PROMPT
# ---------------------------------------------
# Initialize Starship (add this after oh-my-zsh)
eval "$(starship init zsh)"

# ---------------------------------------------
# COLOR ENHANCEMENTS
# ---------------------------------------------
# Enable colors for ls
export CLICOLOR=1
export LSCOLORS=ExGxBxDxCxEgEdxbxgxcxd

# Better LS_COLORS (for GNU ls and zsh completions)
export LS_COLORS='di=1;34:ln=1;36:so=1;35:pi=1;33:ex=1;32:bd=1;33:cd=1;33:su=0;41:sg=0;46:tw=0;42:ow=0;43:*.tar=1;31:*.tgz=1;31:*.zip=1;31:*.z=1;31:*.Z=1;31:*.gz=1;31:*.bz2=1;31:*.jpg=1;35:*.jpeg=1;35:*.gif=1;35:*.bmp=1;35:*.png=1;35:*.tif=1;35:*.tiff=1;35:*.svg=1;35:*.mp4=1;33:*.avi=1;33:*.mov=1;33:*.wmv=1;33:*.mp3=1;33:*.wav=1;33:*.flac=1;33'

# Colorize grep output
export GREP_COLOR='1;32'
export GREP_OPTIONS='--color=auto'

# ---------------------------------------------
# ADDITIONAL TOOLS
# ---------------------------------------------
# Initialize zoxide (smarter cd)
eval "$(zoxide init zsh)"

# Initialize carapace (completions)
eval "$(carapace _carapace)"

# ---------------------------------------------
# COMPLETION STYLING
# ---------------------------------------------
# Enable colors in completions
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"
zstyle ':completion:*:default' list-colors "${(s.:.)LS_COLORS}"

# Group completions and add descriptions
zstyle ':completion:*' group-name ''
zstyle ':completion:*:descriptions' format '%F{yellow}-- %d --%f'
zstyle ':completion:*:messages' format '%F{purple}-- %d --%f'
zstyle ':completion:*:warnings' format '%F{red}-- No Matches Found --%f'

# Add colors to different completion types
zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#) ([0-9a-z-]#)*=01;34=0=01'
zstyle ':completion:*:*:*:*:processes' command "ps -u $USER -o pid,user,comm -w -w"

# Menu selection with colors
zstyle ':completion:*' menu select
zstyle ':completion:*:selected' list-colors "${(@s.:.)LS_COLORS}:ma=48;5;153;38;5;0"

# Case insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|=*' 'l:|=* r:|=*'

# Carapace specific styling
export CARAPACE_BRIDGES='zsh,fish,bash,inshellisense' # Enable multiple shell completions
zstyle ':completion:*:git:*' group-order 'main commands' 'alias commands' 'external commands'

# ---------------------------------------------
# GENERAL SETTINGS
# ---------------------------------------------
# Manual page configuration (like Nushell)
export MANPAGER="nvim +Man!"
export MANWIDTH="999"

# Pyenv configuration
export PYENV_ROOT="$HOME/.pyenv"

# PATH (basic setup)
export PATH="$PYENV_ROOT/bin:$PATH"
export PATH="$PYENV_ROOT/shims:$PATH"
export PATH="$HOME/.local/bin:$HOME/bin:/usr/local/bin:$PATH"
export PATH="$PATH:$HOME/Library/Python/3.9/bin"

export OPENAI_API_KEY="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"
# Locale
export LANG="en_US.UTF-8"
# Editor preference
export EDITOR="nvim"
# Case-insensitive completion
# Uncomment if desired:
# CASE_SENSITIVE="false"
# Hyphen/underscore interchange in completion
# HYPHEN_INSENSITIVE="true"
# Auto-update Oh My Zsh (once every 14 days)
zstyle ':omz:update' mode reminder
zstyle ':omz:update' frequency 14
# Enable command auto-correction
ENABLE_CORRECTION="true"
# Highlight command completion wait time
COMPLETION_WAITING_DOTS="%F{yellow}...%f"
# Persistent history with timestamps (enhanced like Nushell)
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt INC_APPEND_HISTORY  # Write immediately, not on shell exit
setopt SHARE_HISTORY       # Share history across tabs
setopt HIST_IGNORE_DUPS    # Don't store duplicates in history
setopt HIST_IGNORE_ALL_DUPS # Remove older duplicate entries from history
setopt HIST_SAVE_NO_DUPS   # Don't save duplicates to history file
setopt HIST_REDUCE_BLANKS  # Remove extra blanks from history
setopt HIST_VERIFY         # Show command with history expansion to user before running it
HIST_STAMPS="yyyy-mm-dd"
# Terminal title (optional)
# DISABLE_AUTO_TITLE="true"
# Enable better line editing
autoload -U up-line-or-beginning-search down-line-or-beginning-search
zle -N up-line-or-beginning-search
zle -N down-line-or-beginning-search
bindkey "^[[A" up-line-or-beginning-search
bindkey "^[[B" down-line-or-beginning-search

# Vi mode configuration (like Nushell)
bindkey -v
export KEYTIMEOUT=1

# Vi mode cursor changes
function zle-keymap-select {
  if [[ ${KEYMAP} == vicmd ]] ||
     [[ $1 = 'block' ]]; then
    echo -ne '\e[1 q'
  elif [[ ${KEYMAP} == main ]] ||
       [[ ${KEYMAP} == viins ]] ||
       [[ ${KEYMAP} = '' ]] ||
       [[ $1 = 'beam' ]]; then
    echo -ne '\e[5 q'
  fi
}
zle -N zle-keymap-select
zle-line-init() {
    zle -K viins # initiate `vi insert` as keymap (can be removed if `bindkey -V` has been set elsewhere)
    echo -ne "\e[5 q"
}
zle -N zle-line-init
echo -ne '\e[5 q' # Use beam shape cursor on startup.
preexec() { echo -ne '\e[5 q' ;} # Use beam shape cursor for each new prompt.
# ---------------------------------------------
# CUSTOM PLUGIN SOURCES
# ---------------------------------------------
# Syntax highlighting (keep at end of file)
source "$ZSH_CUSTOM/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
# ghcup (Haskell environment)
[ -f "$HOME/.ghcup/env" ] && source "$HOME/.ghcup/env"
# ---------------------------------------------
# ALIASES
# ---------------------------------------------
alias ll="ls -la"
alias la="ls -a"
alias grep="grep --color=auto"
alias zshconfig="nvim ~/.zshrc"
alias ohmyzsh="nvim ~/.oh-my-zsh"
alias g="git"
alias v="nvim"

# Colorful aliases (if you have these tools installed)
alias cat="bat --style=plain" 2>/dev/null || alias cat="cat"
alias ls="eza --icons" 2>/dev/null || ls
alias tree="eza --tree" 2>/dev/null || tree

#!/bin/bash

# Name des Docker-Containers
CONTAINER_NAME="goodnotes-webdav"


# Pfad zum Backup-Ordner auf der externen Festplatte
BACKUP_PATH= "/Users/b.leucht/Library/Mobile Documents/iCloud~md~obsidian/Documents/Vault/GoodNotes"
# WebDAV-Zugangsdaten
USERNAME="goodnotes"
PASSWORD="deinPasswort123"

# Port, unter dem WebDAV erreichbar ist
PORT=8080

# Prüfen, ob Volume existiert
if [ -d "$BACKUP_PATH" ]; then
    echo "[INFO] Backup-Pfad gefunden: $BACKUP_PATH"

    # Prüfen, ob der Container bereits läuft
    if docker ps -a --format '{{.Names}}' | grep -q "^$CONTAINER_NAME$"; then
        echo "[INFO] Container $CONTAINER_NAME existiert bereits. Neustarten..."
        docker start $CONTAINER_NAME
    else
        echo "[INFO] Starte neuen WebDAV-Container..."
        docker run -d \
            --name "$CONTAINER_NAME" \
            -e USERNAME="$USERNAME" \
            -e PASSWORD="$PASSWORD" \
            -v "$BACKUP_PATH":/var/lib/dav \
            -p $PORT:80 \
            --restart unless-stopped \
            bytemark/webdav
    fi
else
    echo "[INFO] WebDAV-Server wurde nicht gestartet."
fi
